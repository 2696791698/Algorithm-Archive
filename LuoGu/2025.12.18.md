# LuoGu 2025.12.18

## P1064 [NOIP 2006 提高组] 金明的预算方案

```c++
#include <algorithm>
#include <iostream>
#include <iomanip>
#include <string>
#include <sstream>
#include <cmath>
#include <vector>
#include <set>
#include <map>
#include <climits>
#include <numeric>
#include <deque>
#include <unordered_set>
#include <unordered_map>
#include <stack>
#include <queue>
#include <utility>

using namespace std;
using ll = long long;
using ull = unsigned long long;

class Stuff {
public:
    int v, p, q, w;
};

void solve() {
    int n, m;
    cin >> n >> m;
    vector<Stuff> mainStuff(m + 1);
    vector<vector<Stuff>> secondaryStuff(m + 1);
    vector<int> dp(n + 1, 0);
    for (int i = 1; i <= m; i++) {
        int v, p, q;
        cin >> v >> p >> q;
        if (q == 0) {
            mainStuff[i] = {v, p, q, v * p};
        } else {
            secondaryStuff[q].push_back({v, p, q, v * p});
        }
    }
    for (int i = 1; i <= m; i++) {
        if (mainStuff[i].v == 0) {
            continue;
        }
        for (int j = n; j >= mainStuff[i].v; j--) {
            dp[j] = max(dp[j], dp[j - mainStuff[i].v] + mainStuff[i].w);

            if (secondaryStuff[i].size() >= 1) {
                int v = mainStuff[i].v + secondaryStuff[i][0].v;
                int w = mainStuff[i].w + secondaryStuff[i][0].w;
                if (j >= v) {
                    dp[j] = max(dp[j], dp[j - v] + w);
                }
            }

            if (secondaryStuff[i].size() >= 2) {
                int v = mainStuff[i].v + secondaryStuff[i][1].v;
                int w = mainStuff[i].w + secondaryStuff[i][1].w;
                if (j >= v) {
                    dp[j] = max(dp[j], dp[j - v] + w);
                }
            }

            if (secondaryStuff[i].size() >= 2) {
                int v = mainStuff[i].v + secondaryStuff[i][0].v + secondaryStuff[i][1].v;
                int w = mainStuff[i].w + secondaryStuff[i][0].w + secondaryStuff[i][1].w;
                if (j >= v) {
                    dp[j] = max(dp[j], dp[j - v] + w);
                }
            }
        }
    }
    cout << dp[n];
}
int main() {
    // ios::sync_with_stdio(false);
    // cin.tie(nullptr);

    solve();
}
```

